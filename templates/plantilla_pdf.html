<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Cotización {{ datos.cotizacion or '' }} — {{ datos.cliente or '' }}</title>
<style>
  /* Reset básico para PDF */
  * { box-sizing: border-box; }
  html, body { margin: 0; padding: 0; font-family: "Segoe UI", system-ui, -apple-system, Roboto, Arial, sans-serif; color: #111827; }
  body { font-size: 12px; line-height: 1.35; }

  /* Paged media */
  @page {
    size: A4;
    margin: 18mm 14mm 20mm 14mm; /* top right bottom left */
    @bottom-center { content: element(footer); }
  }
  /* Evitar cortes feos de filas */
  table, tr, td, th { page-break-inside: avoid; }

  /* Encabezado */
  .header {
    display: flex; align-items: center; gap: 16px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 12px;
  }
  .brand {
    display: flex; align-items: center; gap: 14px; flex: 1;
  }
  .brand img { width: 120px; height: auto; }
  .brand h1 { font-size: 18px; margin: 0; letter-spacing: .2px; }
  .meta {
    text-align: right; font-size: 11px; color: #374151;
  }
  .meta .badge {
    display: inline-block; background: #eef2ff; color: #3730a3; padding: 6px 10px; border-radius: 8px; font-weight: 700; margin-bottom: 6px;
  }

  /* Datos del cliente / cotización */
  .grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0 14px;
  }
  .card {
    border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; background: #fff;
  }
  .card h3 { margin: 0 0 8px; font-size: 12.5px; color: #374151; text-transform: uppercase; letter-spacing: .6px; }
  .row { display: grid; grid-template-columns: 110px 1fr; gap: 6px; margin: 4px 0; }
  .label { color: #6b7280; }
  .value { color: #111827; font-weight: 600; }

  /* Tabla partidas */
  table.items { width: 100%; border-collapse: collapse; margin-top: 6px; }
  .items thead th {
    background: #f3f4f6; color: #111827; font-weight: 700; font-size: 12px; text-align: left; padding: 8px 8px;
    border-bottom: 1px solid #e5e7eb;
  }
  .items tbody td {
    padding: 8px; border-bottom: 1px solid #f1f5f9; vertical-align: top;
  }
  .items .num { text-align: center; width: 28px; color: #6b7280; }
  .items .qty { text-align: center; width: 60px; }
  .items .price, .items .line { text-align: right; width: 100px; white-space: nowrap; }
  .desc { color: #111827; }

  /* Totales */
  .totals-wrap {
    display: grid; grid-template-columns: 1fr 240px; gap: 12px; margin-top: 10px;
  }
  .notes {
    border: 1px dashed #e5e7eb; border-radius: 10px; padding: 10px; font-size: 11px; color: #374151;
  }
  .totals {
    border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; background: #fcfcff;
  }
  .totals table { width: 100%; border-collapse: collapse; font-size: 12.5px; }
  .totals td { padding: 6px 0; }
  .totals td:first-child { color: #6b7280; }
  .totals .strong td { font-weight: 800; color: #111827; border-top: 1px solid #e5e7eb; padding-top: 8px; }

  /* Condiciones / firma */
  .cols-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
  .terms { border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; }
  .terms h4 { margin: 0 0 6px; font-size: 12.5px; color: #374151; }
  .terms ul { margin: 6px 0 0 16px; padding: 0; }
  .terms li { margin: 4px 0; }
  .sign {
    border: 1px dashed #e5e7eb; border-radius: 10px; padding: 14px; display: grid; grid-template-rows: 1fr auto; height: 120px;
  }
  .sign .line { border-top: 1px solid #d1d5db; margin-top: auto; padding-top: 6px; text-align: center; color: #6b7280; }

  /* Footer (paginación) */
  .pdf-footer { position: running(footer); font-size: 11px; color: #6b7280; }
  .pdf-footer .hr { border-top: 1px solid #e5e7eb; margin-bottom: 6px; }
  .pdf-footer .gridf { display: grid; grid-template-columns: 1fr auto; gap: 10px; }
  .small { font-size: 10.5px; color: #6b7280; }
</style>
</head>
<body>

  <!-- Encabezado -->
  <header class="header">
    <div class="brand">
      <img src="{{ url_for('static', filename='img/logo2.png', _external=True) }}" alt="HSC Logo">
      <div>
        <h1>Cotización</h1>
        <div class="small">Apreciable cliente reciba nuestra cotización</div>
      </div>
    </div>
    <div class="meta">
      <div class="badge">COT {{ datos.cotizacion or 'S/F' }}</div>
      <div><strong>Fecha:</strong> {{ datos.fecha or '' }}</div>
    </div>
  </header>

  <!-- Datos del cliente / cotización -->
  <section class="grid">
    <div class="card">
      <h3>Cliente</h3>
      <div class="row"><div class="label">Nombre</div><div class="value">{{ datos.cliente or '' }}</div></div>
      <div class="row">
        <div class="label">Atención</div>
        <div class="value">
          {% if datos.atencion %}
            {% for a in datos.atencion %}{{ a }}{% if not loop.last %}, {% endif %}{% endfor %}
          {% endif %}
        </div>
      </div>
      <div class="row"><div class="label">Dirección</div><div class="value">{{ datos.direccion or '' }}</div></div>
    </div>
    <div class="card">
      <h3>Condiciones</h3>
      <div class="row"><div class="label">Vigencia</div><div class="value">{{ datos.vigencia or '—' }}</div></div>
      <div class="row"><div class="label">Anticipo</div><div class="value">{{ datos.anticipo or '—' }}</div></div>
      <div class="row"><div class="label">Tiempo de entrega</div><div class="value">{{ datos.tiempo or '—' }}</div></div>
      {% if datos.comentarios %}
      <div class="row"><div class="label">Notas</div><div class="value">{{ datos.comentarios }}</div></div>
      {% endif %}
    </div>
  </section>

  <!-- Comentarios / Aclaraciones -->
{% if datos.comentarios %}
<section style="margin-top: 16px;">
  <div style="border: 1px dashed #e5e7eb; border-radius: 10px; padding: 12px; background: #e5e7eb;">
    <strong>Comentarios / Aclaraciones:</strong><br>
    {{ datos.comentarios }}
  </div>
</section>
{% endif %}

  <!-- Partidas -->
  <section>
    <table class="items">
      <thead>
        <tr>
          <th class="num">#</th>
          <th>Descripción</th>
          <th class="qty">Cant.</th>
          <th class="price">Precio</th>
          <th class="line">Importe</th>
        </tr>
      </thead>
      <tbody>
        {% for p in partidas %}
        <tr>
          <td class="num">{{ loop.index }}</td>
          <td class="desc">{{ p.descripcion }}</td>
          <td class="qty">{{ p.cantidad }}</td>
          <td class="price">${{ '%.2f'|format(p.precio) }}</td>
          <td class="line">${{ '%.2f'|format(p.total) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- Totales y notas -->
  <section class="totals-wrap">
    <div class="notes">
      <strong>Observaciones:</strong><br>
      • Precios en MXN, IVA desglosado.<br>
      • Validez de la cotización según “Vigencia”.<br>
      • Tiempos de entrega sujetos a disponibilidad.<br>
      • Cualquier cambio en el alcance puede modificar el precio.
    </div>
    <div class="totals">
      <table>
        <tr><td>Subtotal</td><td style="text-align:right">${{ '%.2f'|format(subtotal) }}</td></tr>
        <tr><td>IVA 16%</td><td style="text-align:right">${{ '%.2f'|format(iva) }}</td></tr>
        <tr class="strong"><td>Total</td><td style="text-align:right">${{ '%.2f'|format(total) }}</td></tr>
      </table>
    </div>
  </section>

  <!-- Condiciones comerciales (a lo ancho) -->
<section style="margin-top: 18px;">
  <div style="border: 1px solid #e5e7eb; border-radius: 10px; padding: 12px;">
    <h4 style="margin: 0 0 6px; font-size: 12.5px; color: #374151;">Condiciones comerciales</h4>
    <ul style="margin: 6px 0 0 16px; padding: 0;">
      <li>Formas de pago: según anticipo indicado, para iniciar trabajo</li>
      <li>Vigencia y alcances según esta propuesta.</li>
      <li>La garantía en mano de obra de reparaciones tendrá un tiempo de 180 días. En el caso de las partes eléctricas, no se
expide garantía más allá de la que expide el fabricante. HSC no se hace responsable por fallas o daños a los equipos por
fuego, inundación, abuso, sabotaje, dolo, desastres naturales, corrosión atmosférica o cualquier otra condición de operación
anormal del equipo. Siempre considerando: operación de acuerdo a manuales de usuario, notificación oportuna con el
mayor detalle de la falla, no exista evidencia de choque eléctrico, arco eléctrico o descarga eléctrica, variación de voltaje de
±5% y variación de corriente no mayor a 5% entre fases, no exista evidencia de corto circuito en instalación de la red
eléctrica.
</li>
      <li>No se reconocen cargos por los costos de operaciones o procesos interrumpidos en ningún caso por fallo del sistema.
</li>
      <li>La cancelación de orden de compra causará una penalización de un 25% sobre el monto total de la misma OC.</li>
      <li>Esta cotización no contempla seguros ni fianzas, en caso de requerirlas favor de solicitarlas para integrarlas en la
propuesta.</li>
    </ul>
  </div>
</section>

  <!-- Footer con numeración -->
  <footer class="pdf-footer">
    <div class="hr"></div>
    <div class="gridf">
      <div>Tel 5527605496 - hectorsc@hscrefrigeracion.com - www.hscrefrigeracion.com</div>
      <div>Página <span class="pageNumber"></span> de <span class="totalPages"></span></div>
    </div>
  </footer>

  <script>
    /* WeasyPrint completa pageNumber/totalPages automáticamente */
  </script>
</body>
</html>
